function scookie(e,i,o){var a=new Date;return a.setDate(a.getDate()+o),document.cookie=e+"="+escape(i)+";expires="+a.toGMTString(),!0}function gcookie(e){return 0<document.cookie.length&&(start=document.cookie.indexOf(e+"="),pos=start+e.length+1,0!=start&&(start=document.cookie.indexOf("; "+e+"="),pos=start+e.length+3),-1!=start)?(start=pos,end=document.cookie.indexOf(";",start),-1==end&&(end=document.cookie.length),unescape(document.cookie.substring(start,end))):""}function theFamousPagePromoLightON(){$("#thefamouspageLink a span:first").fadeIn(1e3,theFamousPagePromoLightOFF)}function theFamousPagePromoLightOFF(){setTimeout('$("#thefamouspageLink a span:first").fadeOut(2000, theFamousPagePromoLightON)',3e3)}function theFamousPagePromoON(){if("okicookie"!=gcookie("theFamousPagePromoCookie")){var e=document.getElementById("theFamousPagePromo"),i=document.getElementById("iphoneContent");null!=e&&null!=i&&(i.style.display="none",e.style.display="block")}}function theFamousPagePromoOFF(){scookie("theFamousPagePromoCookie","okicookie",999);var e=document.getElementById("theFamousPagePromo"),i=document.getElementById("iphoneContent");null!=e&&null!=i&&(e.style.display="none",i.style.display="block")}function showMobileFooter(){var e=document.getElementById("iFooter");null!=e&&(e.style.display="block"),location.href="#iFooterActionLink";var i=document.getElementById("iFooterAction");null!=i&&(i.style.display="none")}function hideMobileFooter(){var e=document.getElementById("iFooter");null!=e&&(e.style.display="none")}function switchItemDisplay(e){element=$("#"+e),null!=element&&(element.is(":visible")?element.slideUp(500):element.slideDown(500))}function switchCheckDisplay(e,i){var o=$("#"+e+"Input"),a=$("#"+i);1==o.prop("checked")?a.slideDown(600):a.slideUp(600)}function switchCheckDisplayOldJS(e,i){var o=document.getElementById(e+"Input"),a=document.getElementById(i);1==o.checked?a.style.display="block":a.style.display="none"}function switchDisplay(e){var i=document.getElementById(e);null!=i&&"block"==i.style.display?i.style.display="none":i.style.display="block"}function isDebugMode(){return"ACTIVE"===gcookie("debugMode")}var bookmarkUrl="/bookmark",bookmarkUrlDebug="/api";function validateConfigForm(){var e=!0,i=$("#skipValidationInput").val();$.isEmptyObject(i)||"false"!=i||(resetFormValidation(),e=appFieldValidation()&&e,e=schemeFieldValidation()&&e,e=phoneNumberFieldValidation()&&e,e=emailValidation()&&e,e=iconFieldValidation()&&e,(e=iconLabelFieldValidation()&&e)||($("#formValidation").fadeIn(1e3),window.scrollTo(0,$("#formValidation").offset().top))),e&&submitForm()}function resetFormValidation(){$("#formValidation").fadeOut(1e3),$("#skipValidationInput").val("false")}function skipValidation(){$("#skipValidationInput").val("true"),submitForm()}function submitForm(){showStep2();var e=$("#appTypeInput").val(),i=$("#appInput").val(),o=$("#schemeInput").val(),a=$("#iconInput").val(),t=$("#iconLabelInput").val(),n=$("#isFullscreenInput").prop("checked"),l=$("#isPopupInput").prop("checked"),r="";$.isEmptyObject($("#phoneNumberInput"))||(r=$("#phoneNumberInput").val());var d="";$.isEmptyObject($("#mailAddressInput"))||(d=$("#mailAddressInput").val());var s="";$.isEmptyObject($("#mailCcInput"))||(s=$("#mailCcInput").val());var c="";$.isEmptyObject($("#mailBccInput"))||(c=$("#mailBccInput").val());var p="";$.isEmptyObject($("#mailSubjectInput"))||(p=$("#mailSubjectInput").val());var m="";$.isEmptyObject($("#mailBodyInput"))||(m=$("#mailBodyInput").val());var u=new FormData,v=$("#uploadIconButton")[0],h=void 0!==v?v.files[0]:"";$.isEmptyObject(h)||u.append("iconFile",$("#uploadIconButton")[0].files[0]),u.append("appType",e),u.append("app",i),u.append("scheme",o),u.append("iconLabel",t),u.append("icon",a),u.append("phoneNumber",r),u.append("mailAddress",d),u.append("mailCc",s),u.append("mailBcc",c),u.append("mailSubject",encodeURIComponent(p)),u.append("mailBody",encodeURIComponent(m)),u.append("isFullscreen",n),u.append("isPopup",l),u.append("action","downloadAppIconProfile"),$.ajax({url:isDebugMode()?msg.bookmark_URL_debug:msg.bookmark_URL,data:u,type:"POST",processData:!1,contentType:!1,cache:!1}).done(function(e){isDebugMode()?e&&e.profileUrl?($("#profileLink").attr("href",e.profileUrl),showStep3(".success")):($("#profileGenerationError").html(msg.bookmark_error),showStep3(".error")):($("#bookmarkGenerationResult").html(e),showStep3(""),$("#bookmarkLink")[0].click())}).error(function(e){isDebugMode()?($("#profileGenerationError").html(e.responseText),showStep3(".error")):($("#bookmarkGenerationResult").html(""),showStep3(""))})}function showStep1(){window.scrollTo(0,$("#topAds").offset().top),$(".generationStep1").fadeIn("500"),$(".generationStep2").hide(),$(".generationStep3").hide(),resetFormValidation()}function showStep2(){window.scrollTo(0,$("#topAds").offset().top),$(".generationStep1").hide(),$(".generationStep2").fadeIn("500"),$(".generationStep3").hide()}function showStep3(e){window.scrollTo(0,$("#topAds").offset().top),$(".generationStep1").hide(),$(".generationStep2").hide(),$(".generationStep3"+e).fadeIn("500")}function appFieldValidation(){var e=!0;resetFormValidation();var i=$("#appInput").val();return $.isEmptyObject(i)&&(validationError("appField",msg.validation_mandatory),e=!1),e&&validationReset("appField"),e}function schemeFieldValidation(){var e=!0;resetFormValidation();var i=$("#appTypeInput").val(),o=$("#appInput").val(),a=$("#schemeInput").val();return"website"==i?$.isEmptyObject(a)?"mercury"==o&&(validationWarning("schemeField",msg.validation_site_emptyKO),e=!1):validateURL(a)?"atomic"!=o&&"atomiclite"!=o&&"dolphin"!=o||isHttpsURL(a)&&(validationWarning("schemeField",msg.validation_site_httpsKO),e=!1):(validationError("schemeField",msg.validation_site_url),e=!1):"custom"==o&&$.isEmptyObject(a)&&(validationError("schemeField",msg.validation_mandatory),e=!1),e&&validationReset("schemeField"),e}function phoneNumberFieldValidation(){var e=!0;resetFormValidation();var i=$("#appInput").val();if("facetime"==i||"phone"==i){var o=$("#phoneNumberInput").val();$.isEmptyObject(o)&&(validationError("phoneNumberField",msg.validation_mandatory),e=!1)}return e&&validationReset("phoneNumberField"),e}function emailValidation(){var e=!0;return"mail"==$("#appInput").val()&&(e=mailAddressFieldValidation()&&mailCcFieldValidation()&&mailBccFieldValidation()),e}function mailAddressFieldValidation(){var e=!0;resetFormValidation();var i=$("#mailAddressInput").val();return $.isEmptyObject(i)||validateEmails(i)||(validationWarning("mailAddressField",msg.validation_emails_to),e=!1),e&&validationReset("mailAddressField"),e}function mailCcFieldValidation(){var e=!0;resetFormValidation();var i=$("#mailCcInput").val();return $.isEmptyObject(i)||validateEmails(i)||(validationWarning("mailCcField",msg.validation_emails_cc),e=!1),e&&validationReset("mailCcField"),e}function mailBccFieldValidation(){var e=!0;resetFormValidation();var i=$("#mailBccInput").val();return $.isEmptyObject(i)||validateEmails(i)||(validationWarning("mailBccField",msg.validation_emails_bcc),e=!1),e&&validationReset("mailBccField"),e}function iconFieldValidation(){var e=!0,i=!1;resetFormValidation();var o=$("#uploadIconButton")[0],a=void 0!==o?o.files[0]:"";if($.isEmptyObject(a)){var t=$("#iconInput").val();$.isEmptyObject(t)?(validationError("iconField",msg.validation_mandatory),e=!1):validateURL(t)?validateIconFormatURL(t)||(validationWarning("iconField",msg.validation_iconFormat_url),i=!(e=!1)):(validationError("iconField",msg.validation_icon_url),e=!1)}return e&&validationReset("iconField"),e||i?e=iconPreview():showIconEmpty(),e}function iconLabelFieldValidation(){var e=!0;resetFormValidation();var i=$("#iconLabelInput").val();return!$.isEmptyObject(i)&&32<i.length&&(validationWarning("iconLabelField",msg.validation_iconLabel_maxlength),e=!1),e&&validationReset("iconLabelField"),e}function validateURL(e){return/^[hH][tT][tT][pP][sS]*:\/\//.test(e)}function isHttpsURL(e){return/^[hH][tT][tT][pP][sS]:\/\//.test(e)}function validateIconFormatURL(e){return/(\.png|\.PNG|\.jpg|\.JPG|\.jpeg|\.JPEG|\.gif|\.GIF|\.ico|\.ICO)$/.test(e)}function validateEmails(e){var o=!0,i=(e=(e=e.replace(/,/g," ")).replace(/(\s)+/g,",")).split(",");return $.each(i,function(e,i){o&=validateEmail($.trim(i))}),o}function validateEmail(e){return/^[a-zA-Z0-9]+[a-zA-Z0-9_.-]+[a-zA-Z0-9_-]+@[a-zA-Z0-9]+[a-zA-Z0-9.-]+.[a-z]{2,4}$/.test(e)}function validationError(e,i){$("#"+e).removeClass("warning"),$("#"+e).addClass("error"),$("#"+e+"Validation").removeClass("warning"),$("#"+e+"Validation").addClass("error"),$("#"+e+"ValidationMessage").text(i),$("#"+e+"Validation").slideDown(600)}function validationWarning(e,i){$("#"+e).removeClass("error"),$("#"+e).addClass("warning"),$("#"+e+"Validation").removeClass("error"),$("#"+e+"Validation").addClass("warning"),$("#"+e+"ValidationMessage").text(i),$("#"+e+"Validation").slideDown(600)}function validationReset(e){$("#"+e).removeClass("error"),$("#"+e).removeClass("warning"),$("#"+e+"Validation").removeClass("error"),$("#"+e+"Validation").removeClass("warning"),$("#"+e+"Validation").slideUp(600),$("#"+e+"ValidationMessage").text("")}function appTypeChanged(){resetFormValidation();var e=$("#appTypeInput").val();jQuery.isEmptyObject(e)?$("#appForm").html(""):($("#appForm").html("<img src='/img/loading.gif' style='margin-left:15px;'/>"),$.ajax({url:"/config-appform.inc.php",data:{lang:msg.lang,appType:e},cache:!1}).done(function(e){$("#appForm").html(e),appChanged()}))}function appChanged(){resetFormValidation();var e=$("#appTypeInput").val(),i=$("#appInput").val();jQuery.isEmptyObject(i)?$("#optionForm").html(""):($("#optionForm").html("<img src='/img/loading.gif' style='margin-left:15px;'/>"),$.ajax({url:"/config-optionform.inc.php",data:{lang:msg.lang,appType:e,app:i},cache:!1}).done(function(e){$("#optionForm").html(e)}).error(function(){$("#optionForm").html("")})),jQuery.isEmptyObject(i)?$("#schemeForm").html(""):($("#schemeForm").html("<img src='/img/loading.gif' style='margin-left:15px;'/>"),$.ajax({url:"/config-schemeform.inc.php",data:{lang:msg.lang,appType:e,app:i},cache:!1}).done(function(e){$("#schemeForm").html(e)}).error(function(){$("#schemeForm").html("")}))}function iconLocalPreview(e){if(e.files&&e.files[0]){showIconLoading();var i=new FileReader;i.onload=function(e){$("#iconLoaded").attr("src",e.target.result),showIconLoaded()},i.readAsDataURL(e.files[0])}}function iconPreview(){var e=!0,i=$("#iconInput").val(),o=$("#iconPreviewURLInput").val(),a=$("#uploadIconButton")[0],t=void 0!==a?a.files[0]:"";return $.isEmptyObject(t)&&(""!=i?i!=o&&(showIconLoading(),$("#iconLoaded").attr("src",i).load(function(){this.complete&&void 0!==this.naturalWidth&&0!=this.naturalWidth?((512<this.naturalWidth||512<this.naturalHeight)&&(validationWarning("iconField",msg.validation_iconPreview_tooBig),e=!0),this.naturalWidth!=this.naturalHeight&&(validationWarning("iconField",msg.validation_iconPreview_notSquared),e=!0),showIconLoaded()):(showIconEmpty(),validationError("iconField",msg.validation_iconPreview_corruptedImage),e=!1)}).error(function(){showIconEmpty(),validationError("iconField",msg.validation_iconPreview_invalidURL),e=!1})):showIconEmpty()),$("#iconPreviewURLInput").val(i),e}function resetIcon(){$("#iconInput").val(""),$("#iconPreviewURLInput").val(""),validationReset("iconField"),console.log("resetIcon",$("#uploadIconButton")[0]),$("#uploadIconButton").val(""),console.log("resetIcon 2",$("#uploadIconButton")[0]),showIconEmpty()}function showIconEmpty(){$("#iconLoading").hide(),$("#iconLoaded").hide(),$("#iconPreviewField").fadeOut(1e3),$("#iconChooseGroup").show()}function showIconLoading(){$("#iconLoading").show(),$("#iconLoaded").hide(),$("#iconPreviewField").fadeIn(1e3)}function showIconLoaded(){$("#iconLoading").hide(),$("#iconLoaded").show(),$("#iconPreviewField").fadeIn(1e3),$("#iconChooseGroup").hide()}msg={validation_mandatory:"This field is mandatory !",validation_site_url:'The website URL address must begin with "http://" or "https://".',validation_site_emptyKO:"You should set an URL for this browser, it cannot be launched without it.",validation_site_httpsKO:'Sorry, but it seems that this browser doesn\'t supports "https://" shortcuts, perhaps it will not work...',validation_icon_url:'The icon URL address must begin with "http://" or "https://".',validation_iconFormat_url:"The icon URL address should ends with a valid image file extension ('.png', '.jpg', '.jpeg', '.gif', '.ico', ...)",validation_iconPreview_corruptedImage:"This image seems to be broken...",validation_iconPreview_invalidURL:"This URL seems to be incorrect...",validation_iconPreview_tooBig:"This image is very large for an icon : it should not work as expected.",validation_iconPreview_notSquared:"This image is not squared : it will be resized and cropped by iOS.",validation_iconLabel_maxlength:"The icon label must be 32 characters maximum",validation_emails_to:"At least one destination email address seems to be incorrect.",validation_emails_cc:"At least one carbon copy email address seems to be incorrect.",validation_emails_bcc:"At least one blank carbon copy email address seems to be incorrect.",bookmark_error:"An unexpected error occurred during your custom icon generation (incorrect response format).",bookmark_URL:bookmarkUrl,bookmark_URL_debug:bookmarkUrlDebug,lang:"en"};